const router = require('express').Router()
const service = require('./account.query')

router.route('/account')
    .get(async (req, res) => {
        await service.selectRecord(req.query, (err, ans) => {
            if (err) return res.status(200).json({
                success: false, error: err
            })
            return res.status(200).json({
                success: true,
                result: ans || {},
            })
        })
    })
    .post(async (req, res) => {
        await service.createRecord(req.body, (err, ans) => {
            if (err) return res.status(200).json({
                success: false, error: err
            })
            return res.status(200).json({
                success: true,
                result: ans || {},
            })
        })
    })
    .patch(async (req, res) => {
        await service.updateRecord(req.body, (err, ans) => {
            if (err) return res.status(200).json({
                success: false, error: err
            })
            return res.status(200).json({
                success: true,
                result: ans || {},
            })
        })
    })
    .delete(async (req, res) => {
        await service.deleteRecord(req.body, (err, ans) => {
            if (err) return res.status(200).json({
                success: false, error: err
            })
            return res.status(200).json({
                success: true,
                result: ans || {},
            })
        })
    })

router.get('/account/element', async (req, res) => {
    await service.uniqueRecord(req.query, (err, ans) => {
        if (err) return res.status(200).json({
            success: false, error: err
        })
        return res.status(200).json({
            success: true,
            result: ans.length === 1 ? ans[0] : {} || {},
        })
    })
})

router.get('/account/search', async (req, res) => {
    await service.searchRecord(req.query, (err, ans) => {
        if (err) return res.status(200).json({
            success: false, error: err
        })
        return res.status(200).json({
            success: true,
            result: ans || {},
        })
    })
})

router.get('/account/login', async (req, res) => {
    await service.loginRecord(req.query, (err, ans) => {
        if (err) return res.status(200).json({
            success: false, error: err
        })
        return res.status(200).json({
            success: true,
            result: ans || {},
        })
    })
})

router.get('/account/logas', async (req, res) => {
    await service.loginAsRecord(req.query, (err, ans) => {
        if (err) return res.status(200).json({
            success: false, error: err
        })
        return res.status(200).json({
            success: true,
            result: ans || {},
        })
    })
})

router.get('/account/token', async (req, res) => {
    await service.tokenRecord(req.query, (err, ans) => {
        if (err) return res.status(200).json({
            success: false, error: err
        })
        return res.status(200).json({
            success: true,
            result: ans.length === 1 ? {
                id: ans[0]?.id,
                name: ans[0]?.name,
                token: ans[0]?.token,
            } : {} || {},
        })
    })
})

module.exports = router